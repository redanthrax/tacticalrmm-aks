# This is a SecretProviderClass example using system-assigned identity to access your key vault
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: trmm-secretstore
  namespace: tacticalrmm
  labels:
    app: trmm
spec:
  provider: azure
  secretObjects:
  - data:
    - key: rmmurlkey
      objectName: RmmUrl
    secretName: rmmurl
    type: Opaque
  - data:
    - key: apiurlkey
      objectName: ApiUrl
    secretName: apiurl
    type: Opaque
  - data:
    - key: meshurlkey
      objectName: MeshUrl
    secretName: meshurl
    type: Opaque
  - data:
    - key: postgresuserkey
      objectName: PostgresUser
    secretName: postgresuser
    type: Opaque
  - data:
    - key: postgrespasskey
      objectName: PostgresPass
    secretName: postgrespass
    type: Opaque
  - data:
    - key: meshuserkey
      objectName: MeshUser
    secretName: meshuser
    type: Opaque
  - data:
    - key: meshpasskey
      objectName: MeshPass
    secretName: meshpass
    type: Opaque
  - data:
    - key: mongouserkey
      objectName: MongoUser
    secretName: mongouser
    type: Opaque
  - data:
    - key: mongopasskey
      objectName: MongoPass
    secretName: mongopass
    type: Opaque
  - data:
    - key: trmmuserkey
      objectName: TrmmUser
    secretName: trmmuser
    type: Opaque
  - data:
    - key: trmmpasskey
      objectName: TrmmPass
    secretName: trmmpass
    type: Opaque
  - data:
    - key: trmmcertkey
      objectName: TrmmCert
    secretName: trmmcert
    type: Opaque
  - data:
    - key: trmmkeykey
      objectName: TrmmKey
    secretName: trmmkey
    type: Opaque
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: "21b630d3-7920-49b4-b2a2-732483e4026a"
    keyvaultName: "trmm-vault"
    cloudName: ""
    objects:  |
      array:
        - |
          objectName: RmmUrl
          objectType: secret
        - |
          objectName: ApiUrl
          objectType: secret
        - |
          objectName: MeshUrl
          objectType: secret
        - |
          objectName: PostgresUser
          objectType: secret
        - |
          objectName: PostgresPass
          objectType: secret
        - |
          objectName: MeshUser
          objectType: secret
        - |
          objectName: MeshPass
          objectType: secret
        - |
          objectName: MongoUser
          objectType: secret
        - |
          objectName: MongoPass
          objectType: secret
        - |
          objectName: TrmmUser
          objectType: secret
        - |
          objectName: TrmmPass
          objectType: secret
        - |
          objectName: TrmmCert
          objectType: secret
        - |
          objectName: TrmmKey
          objectType: secret
    tenantId: "0819678a-52f9-44d6-9ccb-9d3942559a2c" # az account show | grep tenantId